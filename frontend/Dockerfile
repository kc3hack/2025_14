# syntax=docker/dockerfile:latest

# ğŸ”¹ ãƒ“ãƒ«ãƒ‰ç”¨ã‚¹ãƒ†ãƒ¼ã‚¸
FROM --platform=linux/amd64 node:22.12.0-bullseye-slim AS builder

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœ€å°é™ã«æŠ‘ãˆã‚‹ï¼‰
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl git build-essential libffi-dev libssl-dev \
    zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼ˆRender ã® `PORT` ã‚’åˆ©ç”¨ï¼‰
ENV PORT=10000

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
WORKDIR /app

# package.json ã¨ package-lock.json ã‚’å…ˆã«ã‚³ãƒ”ãƒ¼ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€é©åŒ–ï¼‰
COPY package*.json ./

RUN npm ci

# æ®‹ã‚Šã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY . .

# ãƒ“ãƒ«ãƒ‰ï¼ˆã‚‚ã—å¿…è¦ãªã‚‰ï¼‰
# RUN npm run build

# ãƒãƒ¼ãƒˆã‚’å…¬é–‹ï¼ˆRender ã® `PORT` ã«å¯¾å¿œï¼‰
EXPOSE $PORT

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
CMD ["npm", "start"]
